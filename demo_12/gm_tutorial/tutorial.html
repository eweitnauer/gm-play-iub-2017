<!doctype html>
<meta charset="utf-8">
<title>GM Tutorial</title>
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://graspablemath.com/shared/libs/gmath/gm-inject.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="tutorial.css"/>
<script src="tutorial-data.js"></script>

<style type="text/css">
.noShow{
 /*   visibility:hidden;*/
}

</style>
<body>
    <div id="tutorial-container">
        <div id="set1">
            <div id ="1_1" class="levelTutorial container">
                <div id='outer1_1' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                      <!--<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                      <li data-target="#myCarousel" data-slide-to="1"></li>
                      <li data-target="#myCarousel" data-slide-to="2"></li>
                      <li data-target="#myCarousel" data-slide-to="3"></li>-->
                    </ol>
                    <div id='inner1_1' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_1" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_1" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_2" class="levelTutorial container">
                <div id='outer1_2' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_2' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_2" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_2" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_3" class="levelTutorial container">
                <div id='outer1_3' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_3' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_3" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_3" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_4" class="levelTutorial container">
                <div id='outer1_4' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_4' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_4" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_4" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_5" class="levelTutorial container">
                <div id='outer1_5' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_5' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_5" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_5" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_6" class="levelTutorial container">
                <div id='outer1_6' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_6' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_6" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_6" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_7" class="levelTutorial container">
                <div id='outer1_7' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_7' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_7" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_7" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_8" class="levelTutorial container">
                <div id='outer1_8' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_8' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_8" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_8" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_9" class="levelTutorial container">
                <div id='outer1_9' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_9' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_9" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_9" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="1_10" class="levelTutorial container">
                <div id='outer1_10' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner1_10' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer1_10" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer1_10" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
        </div>
        <div id="set2">
            <div id ="2_1" class="levelTutorial container">
                <div id='outer2_1' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                      <!--<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                      <li data-target="#myCarousel" data-slide-to="1"></li>
                      <li data-target="#myCarousel" data-slide-to="2"></li>
                      <li data-target="#myCarousel" data-slide-to="3"></li>-->
                    </ol>
                    <div id='inner2_1' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_1" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_1" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_2" class="levelTutorial container">
                <div id='outer2_2' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_2' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_2" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_2" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_3" class="levelTutorial container">
                <div id='outer2_3' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_3' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_3" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_3" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_4" class="levelTutorial container">
                <div id='outer2_4' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_4' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_4" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_4" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_5" class="levelTutorial container">
                <div id='outer2_5' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_5' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_5" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_5" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_6" class="levelTutorial container">
                <div id='outer6' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_6' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_6" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_6" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_7" class="levelTutorial container">
                <div id='outer2_7' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_7' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_7" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_7" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_8" class="levelTutorial container">
                <div id='outer2_8' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_8' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_8" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_8" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_9" class="levelTutorial container">
                <div id='outer2_9' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_9' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_9" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_9" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
            <div id ="2_10" class="levelTutorial container">
                <div id='outer2_10' class="carousel slide" data-ride="carousel" data-interval="false">
                    <ol class="carousel-indicators">
                    </ol>
                        <div id='inner2_10' class="carousel-inner" role="listbox"></div>

                      <a class="left carousel-control" href="#outer2_10" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="right carousel-control" href="#outer2_10" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                </div>
            </div>
        </div>
    </div>
<script>

window.onload = function () {
loadGM(init, { version: '2.0.3' });  
var g_done_count;
var g_counterInsideLevel = 0;
var derivation_container_size, pairs = [];
function fix_positions() {
  pairs.forEach(function(pair) {
    pair.dl.container_view = derivation_container_size;
    pair.player.dl.container_view = derivation_container_size;
    pair.dl.initPosition();
    pair.player.dl.initPosition();
  });
}

function init() {
    var stage = JSON.parse(window.localStorage.getItem("selectedStage"));
    //console.log(stage);
    if(stage == null){
        stage = 1;
        window.localStorage.setItem("selectedStage", JSON.stringify(stage));
        document.getElementById("set1").classList.remove("noShow");
        document.getElementById("set2").classList.add("noShow");
    }
    else{
        if(stage == 2){
            document.getElementById("set1").classList.add("noShow");
            document.getElementById("set2").classList.remove("noShow");      
        }
        else{
            document.getElementById("set1").classList.remove("noShow");
            document.getElementById("set2").classList.add("noShow");
        }
    }
	
    if (!tutorial_data && !tutorial_data2) return;

    gmath.Derivation.defaultOptions.action_blacklist = ['FlipTermAcrossFractionAction','CombinationRewriteAction',
'EquationRewriteAction', 'ExpressionRewriteAction','FirstLineRewriteAction','FractionRewriteAction','InequalityRewriteAction','IndexFormConversionAction'];
    
	var tutorial_pairs = 0;
    g_done_count = 0;

    var totalLevels =10;
    
    for(var level = 1;level<=totalLevels;level++){
        g_counterInsideLevel = 0;
        if(tutorial_data[level]){
            for(var problemId in tutorial_data[level]){
                var problem =tutorial_data[level][problemId];
                load(problem, 1, level);
            }
        }
        g_counterInsideLevel = 0;
        if(tutorial_data2[level]){
            for(var problemId in tutorial_data2[level]){
                var problem =tutorial_data2[level][problemId];
                load(problem, 2, level);
            }
        }
    }

    
    setTimeout(fix_positions, 1000);

    function getRandomRange(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

	function load(data,stage,level) {

		if (data.events) {
			/* Some repackaging of the data.
			*
			* In the tutorial-data file we set everything on the json events object itself, so now we'll make
			* the events object a property of our settings object.
			*
			*/
			var settings = {
				gestureData: data
			, title: data.title
			, text: data.text
			, eq: data.user_eq || data.options.eq
			, correctAnswers: data.correctAnswers
			, startWiggle: data.startWiggle
			, allow_restart_after_done: true
			, log_mouse_trajectories: false
            ,use_arithmetic_multiplication_symbol:true
			};
			delete data.options.selection_color;

			// Pass in the query selector of the inner div to the tutorial pair, it will use that as the
			// container.
            var set = document.getElementById('set'+stage);
            //console.log("innerDiv for "+stage);
            var innerDiv = set.querySelector('#inner'+stage+"_"+level)
            //console.log(innerDiv);
            //get the ol from innerdiv
            //var x = innerDiv.previousSibling;
            //create new li for the ol
            var newLi = document.createElement('li');
            newLi.setAttribute("data-target","#outer"+stage+"_"+level);
            newLi.setAttribute("data-slide-to",g_counterInsideLevel);
            if(g_counterInsideLevel==0)
              newLi.setAttribute("class", "active");
            //add li to ol

            var newItemDiv = document.createElement('div');

            var newItemDivId = 'item_div' + stage+"_"+level + "_" + g_counterInsideLevel;
            newItemDiv.setAttribute("id", newItemDivId);
            
            if(g_counterInsideLevel==0)
              newItemDiv.setAttribute("class", "item active");
            else
              newItemDiv.setAttribute("class", "item");

            innerDiv.appendChild(newItemDiv);
            var pair = new gmath.ui.TutorialPair("#"+newItemDivId, settings);

            // The tutorial will emit a "done" event when the gesture has been done successfully.
            // We'll call our "done" function when that happens (defined below).
            pair.events.on('done', done.bind(this,level));

            // FIXING ISSUES W/ BOOTSTRAP CAROUSEL
            // The bootstrap carousel is tricky, because we're loading content into elements are not yet
            // rendered and have no dimensions. The first derivation will have the correct canvas size
            // settings, because the first item in the carousel is rendered.
            // Store those dimensions so we can apply them to the other derivations once everything is loaded.
            pairs.push(pair);
            if (!derivation_container_size) derivation_container_size = pair.dl.container_view;
            // Re-bind event listener on the svg of the replay once the svg is rendered. (Actually does this
            // for every tutorial pair right now, which it probably shouldn't).
            $(innerDiv.parentElement).on('slid.bs.carousel', function() {
                pair.play_btn.remove();
                pair.play_btn.init();
            });

            // We'll compare the number of done events with the number of pairs on the page.
            tutorial_pairs++;
            g_counterInsideLevel++;
		}

		else { // text only
            var set = document.getElementById('set'+stage);
            //console.log("innerDiv for "+stage);
            var el = set.querySelector('#inner'+stage+"_"+level)
			//var el = document.getElementById('inner'+level);

			if (data.title) {
				var title = document.createElement('h2');
				var title_content = document.createTextNode(data.title);
				title.appendChild(title_content);
				el.appendChild(title);
			}

			if (data.text) {
				var instructions = document.createElement('p');
				instructions.className = 'tutorial-instructions';
				var instructions_content = document.createTextNode(data.text);
				instructions.appendChild(instructions_content);
				el.appendChild(instructions);
			}
		}
	}

	function done(level) {
		g_done_count++;
        var stage = JSON.parse(window.localStorage.getItem("selectedStage"));
        if(stage==2){
            if (g_done_count === tutorial_data2[level].length) {
                g_done_count = 0;
                window.parent.$("#tutorialModal").modal('hide');
            }
            else{
                $("#set2").find("#inner"+stage+"_"+level).parent().carousel('next');
            }
        }
        else{
            if (g_done_count === tutorial_data[level].length) {
                g_done_count = 0;
                window.parent.$("#tutorialModal").modal('hide');
            }
            else{
                $("#set1").find("#inner"+stage+"_"+level).parent().carousel('next');
            }
        }
	}
}
}
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
